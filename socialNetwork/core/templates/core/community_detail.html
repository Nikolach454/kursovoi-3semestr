{% extends 'core/base.html' %}

{% block title %}{{ community.name }} - –°–æ—Ü–∏–∞–ª—å–Ω–∞—è —Å–µ—Ç—å{% endblock %}

{% block content %}
<style>
    .community-container {
        max-width: 900px;
        margin: 0 auto;
    }
    .community-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border-radius: 12px;
        overflow: hidden;
        margin-bottom: 20px;
    }
    .community-cover {
        height: 200px;
        background: rgba(0,0,0,0.1);
    }
    .community-cover img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }
    .community-info-box {
        padding: 20px 30px 30px;
        color: #fff;
    }
    .community-info-header {
        display: flex;
        align-items: flex-start;
        gap: 20px;
    }
    .community-avatar {
        width: 100px;
        height: 100px;
        border-radius: 16px;
        background: rgba(255,255,255,0.2);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 36px;
        font-weight: bold;
        border: 4px solid rgba(255,255,255,0.3);
        margin-top: -50px;
        flex-shrink: 0;
    }
    .community-avatar img {
        width: 100%;
        height: 100%;
        border-radius: 12px;
        object-fit: cover;
    }
    .community-title-section {
        flex: 1;
    }
    .community-title-section h1 {
        font-size: 28px;
        margin-bottom: 5px;
        color: #fff;
    }
    .community-type-badge {
        display: inline-block;
        padding: 4px 12px;
        background: rgba(255,255,255,0.2);
        border-radius: 12px;
        font-size: 13px;
        margin-bottom: 10px;
    }
    .community-stats {
        display: flex;
        gap: 25px;
        margin-top: 15px;
    }
    .community-stat {
        text-align: center;
    }
    .community-stat-value {
        font-size: 22px;
        font-weight: bold;
    }
    .community-stat-label {
        font-size: 13px;
        opacity: 0.8;
    }
    .community-actions {
        margin-top: 20px;
        display: flex;
        gap: 10px;
    }
    .btn-light {
        background: rgba(255,255,255,0.2);
        color: #fff;
        border: 1px solid rgba(255,255,255,0.3);
    }
    .btn-light:hover {
        background: rgba(255,255,255,0.3);
    }
    .community-section {
        background: #fff;
        border: 1px solid #ddd;
        border-radius: 12px;
        padding: 25px;
        margin-bottom: 20px;
    }
    .community-section h2 {
        font-size: 18px;
        margin-bottom: 15px;
        color: #333;
    }
    .community-description {
        line-height: 1.6;
        color: #333;
    }
    .members-list {
        display: flex;
        gap: 15px;
        flex-wrap: wrap;
    }
    .member-item {
        text-align: center;
        width: 70px;
    }
    .member-avatar {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        color: #fff;
        font-weight: bold;
        font-size: 16px;
        margin: 0 auto 5px;
    }
    .member-avatar img {
        width: 100%;
        height: 100%;
        border-radius: 50%;
        object-fit: cover;
    }
    .member-name {
        font-size: 12px;
        color: #333;
        text-decoration: none;
    }
    .member-name:hover {
        color: #0066cc;
    }
    .member-role {
        font-size: 10px;
        color: #65676b;
    }
    .post-card {
        background: #f8f9fa;
        border: 1px solid #e4e6eb;
        border-radius: 8px;
        padding: 15px;
        margin-bottom: 15px;
    }
    .post-card-header {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 10px;
    }
    .post-card-avatar {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        color: #fff;
        font-weight: bold;
        font-size: 14px;
    }
    .post-card-avatar img {
        width: 100%;
        height: 100%;
        border-radius: 50%;
        object-fit: cover;
    }
    .post-card-info a {
        font-weight: 600;
        color: #333;
        text-decoration: none;
    }
    .post-card-info a:hover {
        color: #0066cc;
    }
    .post-card-time {
        font-size: 12px;
        color: #65676b;
    }
    .post-card-content {
        color: #333;
        line-height: 1.5;
        margin-bottom: 10px;
    }
    .post-card-footer {
        display: flex;
        gap: 15px;
        color: #65676b;
        font-size: 13px;
    }
    .empty-state {
        text-align: center;
        padding: 30px;
        color: #65676b;
    }
</style>

<div class="community-container">
    <div class="community-header">
        <div class="community-cover">
            {% if community.cover %}
                <img src="{{ community.cover.url }}" alt="">
            {% endif %}
        </div>
        <div class="community-info-box">
            <div class="community-info-header">
                <div class="community-avatar">
                    {% if community.avatar %}
                        <img src="{{ community.avatar.url }}" alt="">
                    {% else %}
                        {{ community.name.0 }}
                    {% endif %}
                </div>
                <div class="community-title-section">
                    <h1>{{ community.name }}</h1>
                    <span class="community-type-badge">
                        {% if community.type == 'closed' %}–ó–∞–∫—Ä—ã—Ç–æ–µ —Å–æ–æ–±—â–µ—Å—Ç–≤–æ{% else %}–û—Ç–∫—Ä—ã—Ç–æ–µ —Å–æ–æ–±—â–µ—Å—Ç–≤–æ{% endif %}
                    </span>
                    <div class="community-stats">
                        <div class="community-stat">
                            <div class="community-stat-value">{{ community.members_count }}</div>
                            <div class="community-stat-label">—É—á–∞—Å—Ç–Ω–∏–∫–æ–≤</div>
                        </div>
                        <div class="community-stat">
                            <div class="community-stat-value">{{ community_posts.count }}</div>
                            <div class="community-stat-label">–ø—É–±–ª–∏–∫–∞—Ü–∏–π</div>
                        </div>
                    </div>
                    {% if user.is_authenticated %}
                        <div class="community-actions">
                            {% if is_member %}
                                <span class="btn btn-light" style="cursor: default;">–í—ã —É—á–∞—Å—Ç–Ω–∏–∫</span>
                                {% if community.owner != user %}
                                    <a href="{% url 'core:leave_community' community.id %}" class="btn btn-danger">–ü–æ–∫–∏–Ω—É—Ç—å</a>
                                {% endif %}
                            {% else %}
                                {% if community.type == 'open' %}
                                    <a href="{% url 'core:join_community' community.id %}" class="btn btn-light">–í—Å—Ç—É–ø–∏—Ç—å</a>
                                {% else %}
                                    <span class="btn btn-light" style="cursor: default;">–ó–∞–∫—Ä—ã—Ç–æ–µ —Å–æ–æ–±—â–µ—Å—Ç–≤–æ</span>
                                {% endif %}
                            {% endif %}
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    {% if community.description %}
    <div class="community-section">
        <h2>–û–ø–∏—Å–∞–Ω–∏–µ</h2>
        <div class="community-description">{{ community.description }}</div>
    </div>
    {% endif %}

    <div class="community-section">
        <h2>–£—á–∞—Å—Ç–Ω–∏–∫–∏ ({{ community.members_count }})</h2>
        {% if members %}
            <div class="members-list">
                {% for membership in members %}
                    <div class="member-item">
                        <div class="member-avatar">
                            {% if membership.user.avatar %}
                                <img src="{{ membership.user.avatar.url }}" alt="">
                            {% else %}
                                {{ membership.user.first_name.0 }}{{ membership.user.last_name.0 }}
                            {% endif %}
                        </div>
                        <a href="{% url 'core:user_profile' membership.user.id %}" class="member-name">
                            {{ membership.user.first_name }}
                        </a>
                        {% if membership.role != 'member' %}
                            <div class="member-role">{{ membership.get_role_display }}</div>
                        {% endif %}
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <div class="empty-state">
                <p>–ü–æ–∫–∞ –Ω–µ—Ç —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤</p>
            </div>
        {% endif %}
    </div>

    <div class="community-section">
        <h2>–ü—É–±–ª–∏–∫–∞—Ü–∏–∏ ({{ community_posts.count }})</h2>
        {% if community_posts %}
            {% for post in community_posts %}
                <div class="post-card">
                    <div class="post-card-header">
                        <div class="post-card-avatar">
                            {% if post.author.avatar %}
                                <img src="{{ post.author.avatar.url }}" alt="">
                            {% else %}
                                {{ post.author.first_name.0 }}{{ post.author.last_name.0 }}
                            {% endif %}
                        </div>
                        <div class="post-card-info">
                            <a href="{% url 'core:user_profile' post.author.id %}">{{ post.author.get_full_name }}</a>
                            <div class="post-card-time">{{ post.created_at|date:"d.m.Y –≤ H:i" }}</div>
                        </div>
                    </div>
                    <div class="post-card-content">{{ post.content|truncatewords:50 }}</div>
                    {% if post.media_files.all %}
                        {% for media in post.media_files.all|slice:":1" %}
                            {% if media.type == 'image' %}
                                <img src="{{ media.file.url }}" alt="" style="max-width: 100%; border-radius: 8px; margin-bottom: 10px;">
                            {% endif %}
                        {% endfor %}
                    {% endif %}
                    <div class="post-card-footer">
                        <span>‚ù§ {{ post.likes.count }}</span>
                        <span>üí¨ {{ post.comments.count }}</span>
                        <span>üëÅ {{ post.views_count }}</span>
                        <a href="{% url 'core:post_detail' post.id %}" style="margin-left: auto; color: #0066cc;">–ß–∏—Ç–∞—Ç—å</a>
                    </div>
                </div>
            {% endfor %}
        {% else %}
            <div class="empty-state">
                <p>–í —Å–æ–æ–±—â–µ—Å—Ç–≤–µ –ø–æ–∫–∞ –Ω–µ—Ç –ø—É–±–ª–∏–∫–∞—Ü–∏–π</p>
            </div>
        {% endif %}
    </div>
</div>
{% endblock %}
